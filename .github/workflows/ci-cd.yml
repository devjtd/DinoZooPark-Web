# .github/workflows/ci-cd.yml 
 
name: CI/CD Pipeline 
 
on: 
  push: 
    branches: [ main ] 
  pull_request: 
    branches: [ main ] 

permissions:
  contents: read
  pages: write # Necesario para desplegar en GitHub Pages
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  ci:
    name: Pruebas y validación
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Instalar HTMLHint
        run: npm install -g htmlhint

      # Solución 1: Corregida la indentación de este paso.
      - name: Validar HTML
        run: |
          echo " Ejecutando HTMLHint..."
          htmlhint index.html --rules "tag-pair,attr-value-double-quotes,id-unique,doctype-first"
          echo " HTML válido"
 
      - name: Instalar y ejecutar Lighthouse CI (accesibilidad + mejoras)
        run: |
          npm install -g @lhci/cli@0.15.x
          echo "Auditar con Lighthouse CI (modo 'perf', 'accessibility', 'best-practices')..."
          lhci autorun --upload.target=temporary-public-storage --collect.staticDistDir=. --collect.url=index.html --assert.assertions.accessibility=warn --assert.assertions.performance=warn --assert.assertions['best-practices']=warn
 
  cd:
    name: Despliegue a GitHub Pages
    needs: ci
    if: github.ref == 'refs/heads/main' # Solo en push/merge a main
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
 
    steps:
      - name: Checkout
        uses: actions/checkout@v4
 
      - name: Setup Pages
        uses: actions/configure-pages@v5
 
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.' # Carpeta raíz (index.html, etc.)
 
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
